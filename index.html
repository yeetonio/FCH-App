<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aim Curve Matcher</title>
<link rel="stylesheet" href="style.css" />
</head>

<body>

<header class="app-header">
    <h1>Aim Curve Matcher</h1>
</header>

<main>

<!-- GAME + CURVE SELECTION -->
<section class="selector">
    <label>Game:</label>
    <select id="gameSelect">
        <option value="mw3">MW3 / BO6 / BO7</option>
        <option value="apex">Apex Legends</option>
        <option value="bf6">Battlefield 6</option>
    </select>

    <label>Curve:</label>
    <select id="curveSelect">
        <!-- Populated dynamically -->
    </select>

    <label>Sensitivity:</label>
    <input id="sensInput" type="number" value="7" min="1" max="20" />
</section>


<!-- MAIN GRAPH -->
<section id="graphContainer">
    <canvas id="mainGraph"></canvas>
</section>


<!-- RESULTS SECTION -->
<section id="results">
    <h2>Closest Matches</h2>

    <div class="result-box">
        <h3>Micro Aim (0%–22%)</h3>
        <p id="microCurve"></p>
        <p id="microSens"></p>
    </div>

    <div class="result-box">
        <h3>Macro Aim (22%–100%)</h3>
        <p id="macroCurve"></p>
        <p id="macroSens"></p>
    </div>
</section>


<!-- MINI-GRAPHS -->
<section id="miniCompare">
    <div class="miniBox">
        <h4>Your Curve</h4>
        <canvas id="miniUser"></canvas>
    </div>

    <div class="miniBox">
        <h4>Closest Curve</h4>
        <canvas id="miniClosest"></canvas>
    </div>
</section>


</main>

<script>
/* -------------------------------------------------------
   ACTUAL CURVE DATA (Your real captured points)
------------------------------------------------------- */

const curves = {

    /* ---------------- MW3 / BO7 / WARZONE ---------------- */
    mw3: {
        "Standard": [0, 0.06, 0.12, 0.19, 0.27, 0.36, 0.46, 0.57, 0.69, 0.82, 1],
        "Linear":   [0, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90, 1],
        "Dynamic":  [0, 0.04, 0.10, 0.18, 0.28, 0.40, 0.54, 0.68, 0.82, 0.92, 1]
    },

    /* --------------------- APEX -------------------------- */
    apex: {
        "High Velocity": [0, 0.08, 0.16, 0.26, 0.38, 0.52, 0.66, 0.78, 0.88, 0.95, 1],
        "Linear":        [0, 0.09, 0.18, 0.27, 0.37, 0.48, 0.59, 0.71, 0.82, 0.91, 1],
        "Classic":       [0, 0.06, 0.14, 0.23, 0.33, 0.44, 0.56, 0.67, 0.78, 0.88, 1],
        "Steady":        [0, 0.05, 0.11, 0.19, 0.29, 0.41, 0.55, 0.70, 0.82, 0.91, 1],
        "Fine Aim":      [0, 0.03, 0.08, 0.15, 0.24, 0.36, 0.50, 0.65, 0.79, 0.90, 1]
    },

    /* --------------------- BF6 --------------------------- */
    bf6: {
        "Standard":  [0, 0.05, 0.11, 0.19, 0.28, 0.39, 0.51, 0.64, 0.77, 0.89, 1],
        "2042 Old":  [0, 0.07, 0.15, 0.24, 0.34, 0.45, 0.57, 0.69, 0.80, 0.90, 1],
        "BFV":       [0, 0.06, 0.13, 0.21, 0.31, 0.43, 0.55, 0.67, 0.78, 0.89, 1],
        "BF1–BF4":   [0, 0.05, 0.10, 0.17, 0.26, 0.37, 0.50, 0.63, 0.75, 0.87, 1],
        "BF3":       [0, 0.04, 0.09, 0.16, 0.25, 0.36, 0.48, 0.61, 0.74, 0.86, 1],
        "BFBC2":     [0, 0.03, 0.08, 0.15, 0.23, 0.33, 0.45, 0.58, 0.72, 0.85, 1],
        "BFBC":      [0, 0.02, 0.07, 0.13, 0.21, 0.31, 0.44, 0.58, 0.72, 0.85, 1],
        "Linear":    [0, 0.10, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.90, 1],
        "Dynamic":   [0, 0.03, 0.08, 0.15, 0.25, 0.37, 0.50, 0.63, 0.76, 0.88, 1]
    }

};


/* -------------------------------------------------------
   SENSITIVITY TRANSLATION (simple placeholder)
   — You can replace with real scaling if needed.
------------------------------------------------------- */
function convertSensitivity(baseSens, fromCurve, toCurve) {
    return Number((baseSens * (fromCurve[5] / toCurve[5])).toFixed(2));
}


/* -------------------------------------------------------
   MAIN MATH ENGINE
   - new 22% micro-aim matching
   - separate macro matching
------------------------------------------------------- */

function compareCurves(userCurve, candidateCurve) {

    // Micro = 0–22%
    const cutoffIndex = 2; // index 0=0%, index1≈10%, index2≈20%

    let microError = 0;
    let macroError = 0;

    for (let i = 0; i < userCurve.length; i++) {
        const diff = Math.abs(userCurve[i] - candidateCurve[i]);

        if (i <= cutoffIndex) {
            microError += diff;
        } else {
            macroError += diff;
        }
    }

    return { microError, macroError };
}


/* -------------------------------------------------------
   MAIN APP LOGIC
------------------------------------------------------- */

const gameSelect = document.getElementById("gameSelect");
const curveSelect = document.getElementById("curveSelect");
const sensInput  = document.getElementById("sensInput");

function populateCurves() {
    curveSelect.innerHTML = "";
    let list = curves[gameSelect.value];
    Object.keys(list).forEach(c => {
        let o = document.createElement("option");
        o.value = c;
        o.textContent = c;
        curveSelect.appendChild(o);
    });
}
populateCurves();


function runCalc() {
    const game = gameSelect.value;
    const curve = curveSelect.value;
    const baseSens = Number(sensInput.value);

    const userCurve = curves[game][curve];
    const all = curves;

    let bestMicro = { name:null, score:999 };
    let bestMacro = { name:null, score:999 };

    // Search all curves across all games
    for (let g in all) {
        for (let c in all[g]) {

            const data = compareCurves(userCurve, all[g][c]);

            if (data.microError < bestMicro.score) {
                bestMicro = { name: `${c} (${g.toUpperCase()})`, score: data.microError, raw: all[g][c] };
            }

            if (data.macroError < bestMacro.score) {
                bestMacro = { name: `${c} (${g.toUpperCase()})`, score: data.macroError, raw: all[g][c] };
            }
        }
    }

    document.getElementById("microCurve").textContent =
        `Curve: ${bestMicro.name}`;

    document.getElementById("macroCurve").textContent =
        `Curve: ${bestMacro.name}`;

    document.getElementById("microSens").textContent =
        `Recommended Sens: ${convertSensitivity(baseSens, userCurve, bestMicro.raw)}`;

    document.getElementById("macroSens").textContent =
        `Recommended Sens: ${convertSensitivity(baseSens, userCurve, bestMacro.raw)}`;
}

gameSelect.onchange = () => { populateCurves(); runCalc(); };
curveSelect.onchange = runCalc;
sensInput.oninput = runCalc;

runCalc();

</script>

</body>
</html>
